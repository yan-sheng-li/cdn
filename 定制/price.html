<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>项目加急报价评估｜木子空间</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

    <style>
        .logo {
            max-height: 60px;
            margin-right: 12px;
        }

        .hint {
            font-size: 0.85rem;
            color: #777;
        }

        textarea {
            resize: vertical;
        }
    </style>
</head>

<body class="section">
    <div class="container">
        <div class="column is-half is-offset-one-quarter">

            <!-- Header -->
            <div class="level mb-5">
                <div class="level-left">
                    <img class="logo" src="http://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png">
                    <div>
                        <p class="title is-4 mb-1">项目加急报价评估</p>
                        <p class="subtitle is-6">木子空间</p>
                    </div>
                </div>
            </div>

            <!-- 原报价 -->
            <div class="field">
                <label class="label">原报价（元）</label>
                <input class="input calc" type="number" id="basePrice" placeholder="如 10000">
            </div>

            <!-- 原定完成时间 -->
            <div class="field">
                <label class="label">原定完成时间</label>
                <input class="input calc" type="datetime-local" id="originalDeadline">
            </div>

            <!-- 加急完成时间 -->
            <div class="field">
                <label class="label">加急完成时间</label>
                <input class="input calc" type="datetime-local" id="rushDeadline">
            </div>

            <hr>

            <!-- 兜底规则 -->
            <div class="field">
                <label class="label">最低加急费（元）</label>
                <input class="input calc" type="number" id="minRushFee" value="500">
            </div>

            <div class="field">
                <label class="label">最低项目总价（元）</label>
                <input class="input calc" type="number" id="minTotalPrice" value="3000">
            </div>

            <hr>

            <!-- 结果 -->
            <div class="box">
                <p>时间压缩比例：<strong id="compression">-</strong></p>
                <p>加急系数：<strong id="factor">-</strong></p>
                <p>理论总价：<strong id="rawPrice">-</strong></p>
                <p class="mt-2">
                    最终报价：
                    <span class="has-text-danger has-text-weight-bold" id="finalPrice">-</span>
                </p>
            </div>

            <!-- 报价说明 -->
            <div class="field">
                <label class="label">报价说明（可复制）</label>
                <textarea class="textarea" id="quoteText" rows="5" readonly></textarea>
            </div>

            <button class="button is-link is-fullwidth" id="copyBtn">一键复制报价说明</button>

        </div>
    </div>

    <script>
        function getFactor(rate) {
            if (rate <= 0) return 1;
            if (rate <= 0.2) return 1.2;
            if (rate <= 0.4) return 1.5;
            if (rate <= 0.6) return 1.8;
            return 2.5;
        }

        function hoursBetween(now, future) {
            return (future - now) / 36e5;
        }

        function calculate() {
            const base = +$('#basePrice').val();
            const minRush = +$('#minRushFee').val();
            const minTotal = +$('#minTotalPrice').val();

            const o = new Date($('#originalDeadline').val());
            const r = new Date($('#rushDeadline').val());
            const now = new Date();

            if (!base || !o || !r || r >= o || r <= now) return;

            const oH = hoursBetween(now, o);
            const rH = hoursBetween(now, r);
            const rate = (oH - rH) / oH;
            const factor = getFactor(rate);

            const raw = base * factor;
            const minRushTotal = base + minRush;
            const final = Math.max(raw, minTotal, minRushTotal);

            $('#compression').text((rate * 100).toFixed(0) + '%');
            $('#factor').text(factor);
            $('#rawPrice').text('¥ ' + raw.toLocaleString());
            $('#finalPrice').text('¥ ' + final.toLocaleString());

            $('#quoteText').val(
                `项目原定完成时间为 ${o.toLocaleString()}，
现要求提前至 ${r.toLocaleString()} 完成，
工期压缩 ${(rate * 100).toFixed(0)}%，
按加急系数 ${factor} 计价。

原报价 ¥${base.toLocaleString()}，
最终加急报价为 ¥${final.toLocaleString()}。`
            );
        }

        $('.calc').on('input change', calculate);

        $('#copyBtn').click(function () {
            $('#quoteText').select();
            document.execCommand('copy');
            alert('报价说明已复制');
        });
    </script>

</body>

</html>