<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>项目加急报价评估｜木子空间</title>

  <!-- Bulma -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

  <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

  <style>
    .logo {
      max-height: 60px;
      margin-right: 12px;
    }
    .hint {
      font-size: 0.85rem;
      color: #777;
    }
  </style>
</head>

<body class="section">
<div class="container">
  <div class="column is-half is-offset-one-quarter">

    <!-- Header -->
    <div class="level mb-5">
      <div class="level-left">
        <img class="logo" src="http://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png">
        <div>
          <p class="title is-4 mb-1">项目加急报价评估</p>
          <p class="subtitle is-6">木子空间</p>
        </div>
      </div>
    </div>

    <!-- 原报价 -->
    <div class="field">
      <label class="label">原报价（元）</label>
      <input class="input calc" type="number" id="basePrice" placeholder="如 10000">
    </div>

    <!-- 原定完成时间 -->
    <div class="field">
      <label class="label">原定完成时间</label>
      <input class="input calc" type="datetime-local" id="originalDeadline">
      <p class="hint">基于当前时间自动计算原工期</p>
    </div>

    <!-- 加急完成时间 -->
    <div class="field">
      <label class="label">加急完成时间</label>
      <input class="input calc" type="datetime-local" id="rushDeadline">
      <p class="hint">必须早于原定完成时间</p>
    </div>

    <hr>

    <!-- 结果 -->
    <div class="box">
      <p>原工期：<strong id="originalHours">-</strong> 小时</p>
      <p>加急工期：<strong id="rushHours">-</strong> 小时</p>
      <p>时间压缩比例：<strong id="compression">-</strong></p>
      <p>加急系数：<strong id="factor">-</strong></p>
      <p class="mt-2">
        项目总价：
        <span class="has-text-danger has-text-weight-bold" id="totalPrice">-</span>
      </p>
    </div>

    <!-- 说明 -->
    <article class="message is-info">
      <div class="message-body" id="explanation">
        请输入完整信息以评估加急报价
      </div>
    </article>

  </div>
</div>

<script>
function getFactor(rate) {
  if (rate <= 0) return 1;
  if (rate <= 0.2) return 1.2;
  if (rate <= 0.4) return 1.5;
  if (rate <= 0.6) return 1.8;
  return 2.5;
}

function hoursBetween(now, future) {
  return (future - now) / (1000 * 60 * 60);
}

function calculate() {
  const basePrice = parseFloat($('#basePrice').val());
  const originalDeadline = $('#originalDeadline').val();
  const rushDeadline = $('#rushDeadline').val();

  if (!basePrice || !originalDeadline || !rushDeadline) {
    return;
  }

  const now = new Date();
  const originalDate = new Date(originalDeadline);
  const rushDate = new Date(rushDeadline);

  if (rushDate >= originalDate || rushDate <= now || originalDate <= now) {
    $('#explanation').text('请确保加急时间早于原定时间，且都晚于当前时间');
    return;
  }

  const originalHours = hoursBetween(now, originalDate);
  const rushHours = hoursBetween(now, rushDate);
  const compression = (originalHours - rushHours) / originalHours;
  const factor = getFactor(compression);
  const total = basePrice * factor;

  $('#originalHours').text(originalHours.toFixed(1));
  $('#rushHours').text(rushHours.toFixed(1));
  $('#compression').text((compression * 100).toFixed(0) + '%');
  $('#factor').text(factor.toFixed(1));
  $('#totalPrice').text('¥ ' + total.toLocaleString());

  $('#explanation').text(
    `原计划 ${originalHours.toFixed(1)} 小时完成，现压缩至 ${rushHours.toFixed(1)} 小时（压缩 ${(compression * 100).toFixed(0)}%），按加急系数 ${factor} 计价。`
  );
}

$('.calc').on('input change', calculate);
</script>

</body>
</html>
