<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æœ¨å­ç©ºé—´</title>
  <link rel="icon" type="image/x-icon" href="https://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png" />
  <link href="https://cdn.jsdelivr.net/gh/squarechip/timeline@master/dist/css/timeline.min.css" rel="stylesheet" />

  <style>
    /* åŸºç¡€æ ·å¼ï¼ˆé€šç”¨ï¼‰ */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 0 0 20px 0;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
      &#10;
      padding: 0 20px;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 8px
    }

    p.lead {
      margin: 0 0 6px;
      font-size: 14px;
    }

    /* æœåŠ¡ä¿¡æ¯å¡ç‰‡æ•ˆæœ */
    .service-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      padding: 12px 16px 8px 16px;
      margin-bottom: 20px;
      border: 1px solid #f0f2f5;
      transition: box-shadow 0.3s;
      /* å¸é¡¶ */
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body.dark-theme .service-card {
      background: #16213a;
      border: 1px solid #222c44;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
    }

    /* æ»šåŠ¨é€šçŸ¥æ ·å¼ */
    .marquee-container {
      width: 100%;
      overflow: hidden;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      color: white;
      padding: 8px 0;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .marquee-content {
      display: inline-block;
      white-space: nowrap;
      animation: marquee-scroll 20s linear infinite;
      padding-left: 100%;
    }

    @keyframes marquee-scroll {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    .marquee-container:hover .marquee-content {
      animation-play-state: paused;
    }

    /* æŒ‰é’®æ ·å¼ */
    .theme-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      padding: 6px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #60a5fa;
      color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, .12);
      transition: background 0.2s, transform 0.12s;
    }
    .theme-toggle:active { transform: scale(.98); }
    .theme-toggle svg { width: 18px; height: 18px; }
    .error-msg {
      color: #e11d48;
      margin-top: 6px;
      display: none;
      font-size: 13px;
    }

    /* æŸ¥è¯¢è¾“å…¥æ ·å¼ */
    .query-container {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .query-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 14px;
    }

    .query-btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: #10b981;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    /* æ—¶é—´è½´é€šç”¨ */
    .timeline__content {
      border-radius: 12px;
      padding: 12px 14px;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
      position: relative;
      /* æ–°å¢ï¼šä¸ºæ ‡ç­¾å®šä½æä¾›ç›¸å¯¹å®¹å™¨ */
    }

    .timeline__content h3 {
      margin: 0 0 4px;
      font-size: 15px;
      letter-spacing: .2px;
    }

    .timeline__content .meta {
      display: flex;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      margin-bottom: 6px;
    }

    .timeline__content .meta .tag {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
    }

    .timeline__content.is-current {
      outline: 2px solid #60a5fa;
      outline-offset: -10px;
    }

    /* æ–°å¢ï¼šæœ€æ–°æ ‡ç­¾æ ·å¼ */
    .latest-badge {
      position: absolute;
      top: -8px;
      right: 8px;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
      z-index: 1;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    body.dark-theme .latest-badge {
      background: #c83bf6;
    }

    /* æš—è‰²ä¸»é¢˜ */
    body.dark-theme {
      background: #0b1220;
      color: #e5e7eb;
    }

    body.dark-theme .marquee-container {
      background: linear-gradient(90deg, #1e40af, #1d4ed8);
    }

    body.dark-theme p.lead {
      color: #9ca3af;
    }

    body.dark-theme .timeline__content {
      background: #0f172a;
      border: 1px solid rgba(255, 255, 255, .06);
    }

    body.dark-theme .timeline__content h3 {
      color: #e2e8f0;
    }

    body.dark-theme .timeline__content .meta {
      color: #9ca3af;
    }

    body.dark-theme .timeline__content .meta .tag {
      border: 1px solid rgba(255, 255, 255, .12);
    }

    body.dark-theme .timeline__content p {
      color: #cbd5e1;
    }

    body.dark-theme .timeline:before {
      background: rgba(148, 163, 184, .25)
    }

    /* æµ…è‰²ä¸»é¢˜ */
    body.light-theme {
      background: #ffffff;
      color: #333333;
    }

    body.light-theme .marquee-container {
      background: linear-gradient(90deg, #2563eb, #3b82f6);
    }

    body.light-theme p.lead {
      color: #555555;
    }

    body.light-theme .timeline__content {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, .1);
    }

    body.light-theme .timeline__content h3 {
      color: #111111;
    }

    body.light-theme .timeline__content .meta {
      color: #555555;
    }

    body.light-theme .timeline__content .meta .tag {
      border: 1px solid rgba(0, 0, 0, .12);
    }

    body.light-theme .timeline__content p {
      color: #444444;
    }

    body.light-theme .timeline:before {
      background: rgba(0, 0, 0, .15)
    }

    #countdown-timer {
      font-weight: bold;
      color: #ee1532;
      text-align: center;
      line-height: 2;
    }
  </style>
</head>

<body class="dark-theme">
  

  <!-- æ»šåŠ¨é€šçŸ¥å…¬å‘Š -->
  <div class="marquee-container">
    <div class="marquee-content">
      <span>ğŸ“¢ æœ¨å­ç©ºé—´ï¼šé¡¹ç›®å®šåˆ¶ | è¿œç¨‹è°ƒè¯• | Bugå®¡æŸ¥ä¿®å¤ | é¡¹ç›®å‡çº§æ”¹é€  | é—®é¢˜æ¢è®¨ | æ‰‹æœº/å¾®ä¿¡: 17641244340</span>
    </div>
  </div>

  <div class="container">
    <div class="service-card">
      <div class="query-container">
        <input id="number-input" class="query-input" placeholder="è¯·è¾“å…¥æœåŠ¡ç¼–å·" />
        <button id="query-btn" class="query-btn">æŸ¥è¯¢</button>
        <button id="theme-toggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
          <!-- icon ä¼šç”±è„šæœ¬åˆå§‹åŒ– -->
        </button>
      </div>
      <div id="service-info"></div>
      <div id="error-msg" class="error-msg" aria-live="polite"></div>
    </div>

    <div class="timeline" id="project-timeline">
      <div class="timeline__wrap">
        <div class="timeline__items" id="timeline-items">
          <!-- èŠ‚ç‚¹å†…å®¹å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/squarechip/timeline@master/dist/js/timeline.min.js"></script>
  <script src="https://www.liyansheng.top/cdn/timedown.min.js"></script>
  <script>
    // é€šç”¨ï¼šæ˜¾ç¤º/éšè—é”™è¯¯
    function showError(msg) {
      const el = document.getElementById('error-msg');
      el.textContent = msg;
      el.style.display = 'block';
    }
    function clearError() {
      const el = document.getElementById('error-msg');
      el.textContent = '';
      el.style.display = 'none';
    }

    // åŠ è½½å¹¶æ¸²æŸ“æœåŠ¡ä¿¡æ¯ï¼ˆç”±ç”¨æˆ·ç‚¹å‡»è§¦å‘ï¼‰
    function loadService(number) {
      if (!number) {
        showError('è¯·è¾“å…¥æœ‰æ•ˆçš„ç¼–å·');
        return;
      }
      clearError();
      const queryBtn = document.getElementById('query-btn');
      queryBtn.disabled = true;
      const prevText = queryBtn.textContent;
      queryBtn.textContent = 'æŸ¥è¯¢ä¸­...';

      const itemsContainer = document.getElementById("timeline-items");
      // æ¸…ç†æ—§å†…å®¹
      itemsContainer.innerHTML = '';
      document.getElementById('service-info').innerHTML = '';
      const countdownEl = document.getElementById('countdown-timer');
      if (countdownEl) countdownEl.textContent = '';

      fetch(`https://mini.liyansheng.top/v1/api/targeted-services/service-info/${encodeURIComponent(number)}`)
        .then(response => response.json())
        .then(data => {
          const pageData = data.data;
          if (!pageData) {
            showError('æœªæ‰¾åˆ°è¯¥ç¼–å·çš„æ•°æ®');
            return;
          }
          const serviceInfo = {
            content: pageData.content,
            number: pageData.number,
            customer: pageData.customerName,
            startTime: pageData.startTime,
            endTime: pageData.endTime
          };
          const serviceInfoEl = document.getElementById("service-info");
          serviceInfoEl.innerHTML = `
            <div style='text-align:center;'>
              <h3><span><img src="https://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png" style="max-width:10%;height:auto;" alt="">é¡¹ç›®è¿›åº¦</span></h3>
            </div>
            <p class='lead'>ç¼–å·ï¼š${serviceInfo.number}</p>
            <p class='lead'>å®¢æˆ·ï¼š${serviceInfo.customer}</p>
            <p class='lead'>é¡¹ç›®ï¼š${serviceInfo.content}</p>
            <p class='lead' id='countdown'>â³ï¼š<span id='countdown-timer'></span></p>
          `;

          const timelineData = pageData.timeNodeList || [];
          timelineData.forEach((node, index) => {
            const isFirst = index === 0;
            const item = document.createElement("div");
            item.className = "timeline__item";
            item.innerHTML = `
              <div class="timeline__content ${isFirst ? 'is-current' : ''}" ${isFirst ? 'style="position: relative;"' : ''}>
                ${isFirst ? '<span class="latest-badge">New</span>' : ''}
                <div class="meta"><span>â°${new Date(node.createdAt).toLocaleString()}</span></div>
                <h3>${isFirst ? 'ğŸ”„' : 'âœ…'}${node.title}</h3>
                <p>${node.description}</p>
                ${node.coverUrl ? `<div style='margin:8px 0'><img src='${node.coverUrl}' alt='ç¤ºæ„å›¾' style='max-width:80%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.08);'></div>` : ''}
              </div>
            `;
            itemsContainer.appendChild(item);
          });

          // åˆå§‹åŒ–/åˆ·æ–°æ—¶é—´è½´
          timeline(document.querySelectorAll('.timeline'), {
            verticalStartPosition: 'right',
            verticalTrigger: '150px'
          });

          // åˆå§‹åŒ–å€’è®¡æ—¶
          try {
            new Timedown({
              id: 1,
              endTime: new Date(serviceInfo.endTime).getTime(),
              endText: 'å·²ç»“æŸ',
              selector: '#countdown-timer',
              format: '{d}å¤© {hh}å°æ—¶ {mm}åˆ†é’Ÿ {ss}ç§’'
            });
          } catch (e) {
            console.warn('Timedown åˆå§‹åŒ–å¤±è´¥', e);
          }
        })
        .catch(error => {
          console.error('Error fetching service info:', error);
          showError('è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        })
        .finally(() => {
          queryBtn.disabled = false;
          queryBtn.textContent = prevText;
        });
    }

    // ç»‘å®šæŸ¥è¯¢æŒ‰é’®ä¸å›è½¦äº‹ä»¶
    document.getElementById('query-btn').addEventListener('click', () => {
      const val = document.getElementById('number-input').value.trim();
      loadService(val);
    });
    document.getElementById('number-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const val = e.target.value.trim();
        loadService(val);
      }
    });

    // ä¸»é¢˜åˆ‡æ¢é€»è¾‘ï¼šä½¿ç”¨å›¾æ ‡ï¼ˆå¤ªé˜³ / æœˆäº®ï¼‰æ›¿æ¢æ–‡å­—
    const themeToggle = document.getElementById('theme-toggle');
    function sunSVG() {
      return `
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5" fill="none" />
          <g stroke="currentColor" stroke-width="1.5">
            <path d="M12 2v2" />
            <path d="M12 20v2" />
            <path d="M4.93 4.93l1.41 1.41" />
            <path d="M17.66 17.66l1.41 1.41" />
            <path d="M2 12h2" />
            <path d="M20 12h2" />
            <path d="M4.93 19.07l1.41-1.41" />
            <path d="M17.66 6.34l1.41-1.41" />
          </g>
        </svg>`;
    }
    function moonSVG() {
      return `
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="1.5" fill="none" />
        </svg>`;
    }
    function updateThemeIcon() {
      if (!themeToggle) return;
      const isDark = document.body.classList.contains('dark-theme');
      themeToggle.innerHTML = isDark ? moonSVG() : sunSVG();
      themeToggle.title = isDark ? 'å½“å‰ï¼šæš—è‰²' : 'å½“å‰ï¼šæµ…è‰²';
    }
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      document.body.classList.toggle('light-theme');
      updateThemeIcon();
    });
    updateThemeIcon();
  </script>
</body>

</html>