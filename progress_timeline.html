<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>木子空间</title>
  <link rel="icon" type="image/x-icon" href="https://cdn.qiniu.liyansheng.top/img/graphic-4005286_640.png" />
  <link href="https://cdn.jsdelivr.net/gh/squarechip/timeline@master/dist/css/timeline.min.css" rel="stylesheet" />

  <style>
    /* 基础样式（通用） */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 32px;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      max-width: 960px;
      margin: 0 auto
    }

    h1 {
      font-size: 24px;
      margin: 0 0 12px
    }

    p.lead {
      margin: 0 0 10px
    }

    /* 服务信息卡片效果 */
    .service-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      padding: 22px 28px 10px 28px;
      margin-bottom: 32px;
      border: 1px solid #f0f2f5;
      transition: box-shadow 0.3s;
      /* 吸顶 */
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body.dark-theme .service-card {
      background: #16213a;
      border: 1px solid #222c44;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
    }

    /* 按钮样式 */
    .theme-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #60a5fa;
      color: #fff;
      font-size: 14px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, .2);
      z-index: 1000;
    }

    /* 时间轴通用 */
    .timeline__content {
      border-radius: 14px;
      padding: 16px 18px;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }

    .timeline__content h3 {
      margin: 0 0 6px;
      font-size: 16px;
      letter-spacing: .2px;
    }

    .timeline__content .meta {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 12px;
      margin-bottom: 8px;
    }

    .timeline__content .meta .tag {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
    }

    .timeline__content.is-current {
      outline: 2px solid #60a5fa;
      outline-offset: -10px;
    }

    /* 暗色主题 */
    body.dark-theme {
      background: #0b1220;
      color: #e5e7eb;
    }

    body.dark-theme p.lead {
      color: #9ca3af;
    }

    body.dark-theme .timeline__content {
      background: #0f172a;
      border: 1px solid rgba(255, 255, 255, .06);
    }

    body.dark-theme .timeline__content h3 {
      color: #e2e8f0;
    }

    body.dark-theme .timeline__content .meta {
      color: #9ca3af;
    }

    body.dark-theme .timeline__content .meta .tag {
      border: 1px solid rgba(255, 255, 255, .12);
    }

    body.dark-theme .timeline__content p {
      color: #cbd5e1;
    }

    body.dark-theme .timeline:before {
      background: rgba(148, 163, 184, .25)
    }

    /* 浅色主题 */
    body.light-theme {
      background: #ffffff;
      color: #333333;
    }

    body.light-theme p.lead {
      color: #555555;
    }

    body.light-theme .timeline__content {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, .1);
    }

    body.light-theme .timeline__content h3 {
      color: #111111;
    }

    body.light-theme .timeline__content .meta {
      color: #555555;
    }

    body.light-theme .timeline__content .meta .tag {
      border: 1px solid rgba(0, 0, 0, .12);
    }

    body.light-theme .timeline__content p {
      color: #444444;
    }

    body.light-theme .timeline:before {
      background: rgba(0, 0, 0, .15)
    }

    #countdown-timer {
      font-weight: bold;
      color: #ee1532;
      text-align: center;
      line-height: 2;
    }
  </style>
</head>

<body class="dark-theme">
  <button class="theme-toggle" id="theme-toggle">切换主题</button>

  <div class="container">

    <div class="service-card">
      <div id="service-info"></div>
    </div>

    <div class="timeline" id="project-timeline">
      <div class="timeline__wrap">
        <div class="timeline__items" id="timeline-items">
          <!-- 节点内容将由 JS 动态生成 -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/squarechip/timeline@master/dist/js/timeline.min.js"></script>
  <script src="https://www.liyansheng.top/cdn/timedown.min.js"></script>
  <script>
    // 获取路径参数
    const urlParams = new URLSearchParams(window.location.search);
    const number = urlParams.get('number');
    fetch(`https://mini.liyansheng.top/v1/api/targeted-services/service-info/${number}`)
      .then(response => response.json())
      .then(data => {
        const pageData = data.data;
        // 服务信息数据
        const serviceInfo = {
          content: pageData.content,
          number: pageData.number,
          customer: pageData.customerName,
          startTime: pageData.startTime,
          endTime: pageData.endTime
        };
        // 渲染服务信息
        const serviceInfoEl = document.getElementById("service-info");
        serviceInfoEl.innerHTML = `
            <div style='text-align:center;'>
            <h2>项目进度跟踪</h2>
            </div>
          <p class='lead'>服务编号：${serviceInfo.number}</p>
          <p class='lead'>客户名称：${serviceInfo.customer}</p>
            <p class='lead'>项目周期：${new Date(serviceInfo.startTime).toLocaleString()} - ${new Date(serviceInfo.endTime).toLocaleString()}</p>
          <p class='lead'>项目内容：${serviceInfo.content}</p>
          <p class='lead' id='countdown'>剩余时间：<span id='countdown-timer'></span></p>
        `;
        // 节点数据 JSON，新增 cover 字段（可用图片链接或 base64 占位图）
        const timelineData = (pageData.timeNodeList || []).slice().reverse();
        // 渲染节点，增加 cover 示意图
        const itemsContainer = document.getElementById("timeline-items");
        timelineData.forEach((node, index) => {
          const isLast = index === 0; // 判断是否最后一个
          const item = document.createElement("div");
          item.className = "timeline__item";
          item.innerHTML = `
            <div class="timeline__content ${isLast ? 'is-current' : ''}">
              <div class="meta"><span>⏰${new Date(node.createdAt).toLocaleString()}</span></div>
              <h3>✅${node.title}</h3>
              <p>${node.description}</p>
              ${node.coverUrl ? `<div style='margin:8px 0'><img src='${node.coverUrl}' alt='示意图' style='max-width:80%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.08);'></div>` : ''}
            </div>
          `;
          itemsContainer.appendChild(item);
        });
        // 初始化时间轴
        timeline(document.querySelectorAll('.timeline'), {
          verticalStartPosition: 'right',
          verticalTrigger: '150px'
        });
        // 主题切换逻辑
        const btn = document.getElementById('theme-toggle');
        btn.addEventListener('click', () => {
          document.body.classList.toggle('dark-theme');
          document.body.classList.toggle('light-theme');
          btn.textContent = document.body.classList.contains('dark-theme') ? '切换为浅色' : '切换为暗色';
        });
        btn.textContent = '切换为浅色';
        // 初始化倒计时，确保节点已渲染
        new Timedown({
          id: 1,
          endTime: new Date(serviceInfo.endTime).getTime(),
          endText: '已结束',
          selector: '#countdown-timer',
          format: '{d}天 {hh}小时 {mm}分钟 {ss}秒',
          endCallback: () => alert('倒计时结束！')
        });
      })
      .catch(error => {
        console.error('Error fetching service info:', error);
      });


  </script>
</body>

</html>